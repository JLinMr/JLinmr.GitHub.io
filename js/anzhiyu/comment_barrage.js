if(document.querySelector(".comment-barrage")){var commentBarrageConfig={maxBarrage:GLOBAL_CONFIG.commentBarrageConfig.maxBarrage,barrageTime:GLOBAL_CONFIG.commentBarrageConfig.barrageTime,twikooUrl:GLOBAL_CONFIG.twikooEnvId,accessToken:GLOBAL_CONFIG.commentBarrageConfig.accessToken,mailMd5:GLOBAL_CONFIG.commentBarrageConfig.mailMd5,pageUrl:window.location.pathname,barrageTimer:[],barrageList:[],barrageIndex:0,dom:document.querySelector(".comment-barrage")},commentInterval=null,hoverOnCommentBarrage=!1;function initCommentBarrage(){if(commentBarrageConfig.dom){var e=JSON.stringify({event:"COMMENT_GET","commentBarrageConfig.accessToken":commentBarrageConfig.accessToken,url:commentBarrageConfig.pageUrl}),a=new XMLHttpRequest;a.withCredentials=!0,a.addEventListener("readystatechange",(function(){4===this.readyState&&this.responseText&&(commentBarrageConfig.barrageList=commentLinkFilter(JSON.parse(this.responseText).data),commentBarrageConfig.dom.innerHTML="")})),a.open("POST",commentBarrageConfig.twikooUrl),a.setRequestHeader("Content-Type","application/json"),a.send(e),clearInterval(commentInterval),commentInterval=null,commentInterval=setInterval((()=>{commentBarrageConfig.barrageList.length&&!hoverOnCommentBarrage&&(popCommentBarrage(commentBarrageConfig.barrageList[commentBarrageConfig.barrageIndex]),commentBarrageConfig.barrageIndex+=1,commentBarrageConfig.barrageIndex%=commentBarrageConfig.barrageList.length),commentBarrageConfig.barrageTimer.length>(commentBarrageConfig.barrageList.length>commentBarrageConfig.maxBarrage?commentBarrageConfig.maxBarrage:commentBarrageConfig.barrageList.length)&&!hoverOnCommentBarrage&&removeCommentBarrage(commentBarrageConfig.barrageTimer.shift())}),commentBarrageConfig.barrageTime)}}function commentLinkFilter(e){e.sort(((e,a)=>e.created-a.created));let a=[];return e.forEach((e=>{a.push(...getCommentReplies(e))})),a}function getCommentReplies(e){if(e.replies){let a=[e];return e.replies.forEach((e=>{a.push(...getCommentReplies(e))})),a}return[]}function popCommentBarrage(e){let a=document.createElement("div");a.className="comment-barrage-item",a.innerHTML=`\n          <div class="barrageHead">\n            <a class="barrageTitle ${e.mailMd5===commentBarrageConfig.mailMd5?"barrageBloggerTitle":""}" href="javascript:anzhiyu.scrollTo('#post-comment')"">\n              ${e.mailMd5===commentBarrageConfig.mailMd5?"博主":"热评"}\n            </a>\n            <div class="barrageNick">${e.nick}</div>\n            <img class="nolazyload barrageAvatar" src="https://weavatar.com/avatar/${e.mailMd5}"/>\n            <a class="comment-barrage-close" href="javascript:anzhiyu.switchCommentBarrage()"><i class="anzhiyufont anzhiyu-icon-xmark"></i></a>\n          </div>\n          <anzhiyu class="barrageContent" onClick="window.location.hash = '${e.id}'">\n            ${e.comment}\n          </anzhiyu>\n        `,a.querySelectorAll("anzhiyu pre").forEach((e=>{let a=document.createElement("span");a.innerText="【代码】",e.parentNode.replaceChild(a,e)})),a.querySelectorAll("anzhiyu img").forEach((e=>{if(!e.classList.contains("tk-owo-emotion")){e.style.display="none";let a=document.createElement("span");a.innerText="【图片】",e.parentNode.replaceChild(a,e)}})),commentBarrageConfig.barrageTimer.push(a),commentBarrageConfig.dom.append(a)}function removeCommentBarrage(e){e.className="comment-barrage-item out",setTimeout((()=>{commentBarrageConfig.dom&&commentBarrageConfig.dom.contains(e)&&commentBarrageConfig.dom.removeChild(e)}),1e3)}document.querySelector(".comment-barrage").addEventListener("mouseenter",(function(){hoverOnCommentBarrage=!0})),document.querySelector(".comment-barrage").addEventListener("mouseleave",(function(){hoverOnCommentBarrage=!1}));const e=new IntersectionObserver((e=>{const a=document.querySelector(".comment-barrage"),r=document.getElementById("post-comment");e.forEach((e=>{r&&a&&document.body.clientWidth>768&&(a.style.bottom=e.isIntersecting?`-${200*commentBarrageConfig.maxBarrage}px`:"0")}))}),{root:null,rootMargin:"0px",threshold:0}),a=document.getElementById("post-comment");a&&e.observe(a),initCommentBarrage(),"false"!==localStorage.getItem("commentBarrageSwitch")?(document.querySelector(".comment-barrage").style.display="flex",document.querySelector(".menu-commentBarrage-text").textContent="关闭热评"):(document.querySelector(".comment-barrage").style.display="none",document.querySelector(".menu-commentBarrage-text").textContent="显示热评"),document.addEventListener("pjax:send",(function(){clearInterval(commentInterval)}))}BarrageConfig[_0x237fb5(0x158)]%=commentBarrageConfig[_0x237fb5(0x172)][_0x237fb5(0x160)]),commentBarrageConfig[_0x237fb5(0x14b)]['length']>(commentBarrageConfig['barrageList']['length']>commentBarrageConfig[_0x237fb5(0x14e)]?commentBarrageConfig[_0x237fb5(0x14e)]:commentBarrageConfig[_0x237fb5(0x172)][_0x237fb5(0x160)])&&!hoverOnCommentBarrage&&removeCommentBarrage(commentBarrageConfig[_0x237fb5(0x14b)][_0x237fb5(0x167)]());},commentBarrageConfig[_0x4b2061(0x163)]);}function commentLinkFilter(_0x2c3a05){const _0x61439=_0x54d008;_0x2c3a05[_0x61439(0x178)]((_0x1dfa32,_0x440ee2)=>{const _0x41a3bd=_0x61439;return _0x1dfa32['created']-_0x440ee2[_0x41a3bd(0x162)];});let _0x1e917f=[];return _0x2c3a05[_0x61439(0x157)](_0x3a0dff=>{const _0x1818d=_0x61439;_0x1e917f[_0x1818d(0x189)](...getCommentReplies(_0x3a0dff));}),_0x1e917f;}function getCommentReplies(_0x3a350c){const _0x4c92c1=_0x54d008;if(_0x3a350c[_0x4c92c1(0x187)]){let _0x182d1b=[_0x3a350c];return _0x3a350c[_0x4c92c1(0x187)]['forEach'](_0x26d8a8=>{const _0x31560a=_0x4c92c1;_0x182d1b[_0x31560a(0x189)](...getCommentReplies(_0x26d8a8));}),_0x182d1b;}else return[];}function popCommentBarrage(_0x5f2a91){const _0x1ed23d=_0x54d008;let _0x440aeb=document[_0x1ed23d(0x15e)](_0x1ed23d(0x15b));_0x440aeb[_0x1ed23d(0x16f)]='comment-barrage-item',_0x440aeb[_0x1ed23d(0x16b)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22barrageHead\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20class=\x22barrageTitle\x20'+(_0x5f2a91[_0x1ed23d(0x159)]===commentBarrageConfig[_0x1ed23d(0x159)]?'barrageBloggerTitle':'')+_0x1ed23d(0x169)+(_0x5f2a91['mailMd5']===commentBarrageConfig['mailMd5']?'博主':'热评')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22barrageNick\x22>'+_0x5f2a91[_0x1ed23d(0x149)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20class=\x22nolazyload\x20barrageAvatar\x22\x20src=\x22https://weavatar.com/avatar/'+_0x5f2a91['mailMd5']+_0x1ed23d(0x18d)+_0x5f2a91['id']+_0x1ed23d(0x17b)+_0x5f2a91[_0x1ed23d(0x154)]+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</anzhiyu>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';let _0x3ba6f4=_0x440aeb['querySelectorAll'](_0x1ed23d(0x164));_0x3ba6f4[_0x1ed23d(0x157)](_0x333c3e=>{const _0x6d1a0d=_0x1ed23d;let _0x483775=document[_0x6d1a0d(0x15e)](_0x6d1a0d(0x161));_0x483775[_0x6d1a0d(0x15a)]='【代码】',_0x333c3e[_0x6d1a0d(0x152)][_0x6d1a0d(0x16a)](_0x483775,_0x333c3e);});let _0x49e8b3=_0x440aeb[_0x1ed23d(0x148)](_0x1ed23d(0x18e));_0x49e8b3[_0x1ed23d(0x157)](_0xda40f0=>{const _0x2538b9=_0x1ed23d;if(!_0xda40f0[_0x2538b9(0x181)][_0x2538b9(0x192)](_0x2538b9(0x190))){_0xda40f0['style']['display']=_0x2538b9(0x175);let _0x26eb05=document['createElement'](_0x2538b9(0x161));_0x26eb05['innerText']='【图片】',_0xda40f0['parentNode']['replaceChild'](_0x26eb05,_0xda40f0);}}),commentBarrageConfig[_0x1ed23d(0x14b)][_0x1ed23d(0x189)](_0x440aeb),commentBarrageConfig[_0x1ed23d(0x183)][_0x1ed23d(0x177)](_0x440aeb);}function removeCommentBarrage(_0x4635c8){const _0x62c210=_0x54d008;_0x4635c8[_0x62c210(0x16f)]='comment-barrage-item\x20out',setTimeout(()=>{const _0x52b700=_0x62c210;commentBarrageConfig[_0x52b700(0x183)]&&commentBarrageConfig[_0x52b700(0x183)]['contains'](_0x4635c8)&&commentBarrageConfig['dom']['removeChild'](_0x4635c8);},0x3e8);}const commentEntryCallback=_0x312f90=>{const _0x5e0561=_0x54d008,_0x56a1e5=document[_0x5e0561(0x17d)]('.comment-barrage'),_0x5084ff=document[_0x5e0561(0x14a)](_0x5e0561(0x176));_0x312f90['forEach'](_0x1b09eb=>{const _0x438619=_0x5e0561;_0x5084ff&&_0x56a1e5&&document[_0x438619(0x156)][_0x438619(0x184)]>0x300&&(_0x56a1e5[_0x438619(0x174)][_0x438619(0x171)]=_0x1b09eb['isIntersecting']?'-'+commentBarrageConfig[_0x438619(0x14e)]*0xc8+'px':'0');});},observer=new IntersectionObserver(commentEntryCallback,{'root':null,'rootMargin':'0px','threshold':0x0}),postCommentTarget=document['getElementById'](_0x54d008(0x176));postCommentTarget&&observer['observe'](postCommentTarget),initCommentBarrage(),localStorage['getItem']('commentBarrageSwitch')!=='false'?(document[_0x54d008(0x17d)](_0x54d008(0x170))[_0x54d008(0x174)][_0x54d008(0x144)]=_0x54d008(0x145),document[_0x54d008(0x17d)](_0x54d008(0x179))['textContent']=_0x54d008(0x14d)):(document[_0x54d008(0x17d)]('.comment-barrage')[_0x54d008(0x174)][_0x54d008(0x144)]='none',document['querySelector'](_0x54d008(0x179))[_0x54d008(0x17e)]=_0x54d008(0x16c)),document[_0x54d008(0x18b)]('pjax:send',function(){clearInterval(commentInterval);});}